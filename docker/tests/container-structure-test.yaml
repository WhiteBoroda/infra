schemaVersion: '2.0.0'

# Command tests - verify required commands are available
commandTests:
  - name: 'odoo-bin exists'
    command: 'which'
    args: ['odoo-bin']
    expectedOutput: ['/usr/bin/odoo-bin']

  - name: 'python3 version'
    command: 'python3'
    args: ['--version']
    expectedOutput: ['Python 3.*']

  - name: 'pip3 is installed'
    command: 'which'
    args: ['pip3']
    exitCode: 0

  - name: 'check odoo version'
    command: 'odoo'
    args: ['--version']
    expectedOutput: ['Odoo Server 17.0']

# File existence tests
fileExistenceTests:
  - name: 'Odoo configuration directory exists'
    path: '/etc/odoo'
    shouldExist: true
    isDirectory: true

  - name: 'Odoo addons directory exists'
    path: '/mnt/extra-addons'
    shouldExist: true
    isDirectory: true

  - name: 'Odoo log directory exists'
    path: '/var/log/odoo'
    shouldExist: true
    isDirectory: true

  - name: 'Python requirements installed'
    path: '/usr/local/lib/python3.11/site-packages'
    shouldExist: true
    isDirectory: true

# File content tests
fileContentTests:
  - name: 'Check if custom requirements were installed'
    path: '/requirements.txt'
    shouldExist: true
    expectedContents: ['pytest.*', 'coverage.*']

# Metadata tests
metadataTest:
  env:
    - key: 'ODOO_RC'
      value: '/etc/odoo/odoo.conf'
    - key: 'LANG'
      value: 'C.UTF-8'

  exposedPorts: ['8069', '8072']

  workdir: '/usr/lib/python3/dist-packages/odoo'

  cmd: ['odoo']

# License tests (optional)
licenseTests:
  - debian: true
    files: []

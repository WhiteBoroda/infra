# config/variables.yaml
# Centralізовані змінні для всього проекту

# Project Configuration
project:
  name: "odoo-project"
  company: "yourdomain"
  
# Registry Configuration
registry:
  url: "registry.gitlab.yourdomain.com"
  namespace: "odoo-team"

# Domain Configuration
domains:
  base: "yourdomain.com"
  test: "test.yourdomain.com"
  dev: "dev.yourdomain.com"
  stage: "stage.yourdomain.com"
  prod: "yourdomain.com"

# Kubernetes Namespaces
namespaces:
  test: "odoo-test"
  dev: "odoo-dev"
  stage: "odoo-stage"
  prod: "odoo-prod"
  gitlab_runner: "gitlab-runner"
  postgres_operator: "postgres-operator"

# Docker Images
images:
  odoo:
    base: "odoo"
    version: "17.0"
  postgres:
    base: "postgres"
    version: "15"
  redis:
    base: "redis"
    version: "7-alpine"
  pgbouncer:
    base: "pgbouncer/pgbouncer"
    version: "1.21.0"
  patroni:
    base: "patroni/patroni"
    version: "3.2.2"
  etcd:
    base: "quay.io/coreos/etcd"
    version: "v3.5.11"

# Database Configuration
database:
  superuser: "postgres"
  app_user: "odoo"
  replication_user: "replicator"
  names:
    prod: "odoo_prod"
    stage: "odoo_stage"
    dev: "odoo_dev"
    test: "odoo_test"
  
  # PostgreSQL Parameters
  postgres:
    max_connections: 300
    shared_buffers: "2GB"
    effective_cache_size: "6GB"
    maintenance_work_mem: "512MB"
    checkpoint_completion_target: 0.9
    wal_buffers: "16MB"
    work_mem: "10MB"
    min_wal_size: "1GB"
    max_wal_size: "4GB"
    max_worker_processes: 4
    max_parallel_workers: 4

  # PgBouncer Configuration
  pgbouncer:
    port: 6432
    max_client_conn: 1000
    default_pool_size: 25
    min_pool_size: 10
    reserve_pool_size: 5
    max_db_connections: 100
    pool_mode: "transaction"
    server_idle_timeout: 600
    server_lifetime: 3600

  # Patroni Configuration
  patroni:
    scope: "odoo-postgres"
    ttl: 30
    loop_wait: 10
    retry_timeout: 10
    replicas: 3

# Redis Configuration
redis:
  port: 6379
  db: 1
  prefix: "odoo_session"
  expiration: 86400  # 24 hours
  maxmemory:
    test: "128mb"
    dev: "256mb"
    stage: "512mb"
    prod: "1gb"

# Odoo Configuration
odoo:
  ports:
    http: 8069
    longpolling: 8072
  
  # Workers по середовищам
  workers:
    test: 1
    dev: 2
    stage: 3
    prod: 6
  
  # Cron threads
  cron_threads:
    test: 1
    dev: 1
    stage: 2
    prod: 2
  
  # Replicas
  replicas:
    test: 1
    dev: 2
    stage: 2
    prod: 4
  
  # Memory limits
  memory:
    limit_memory_hard: 2684354560  # 2.5 GB
    limit_memory_soft: 2147483648  # 2 GB
    limit_request: 8192
    limit_time_cpu: 600
    limit_time_real: 1200

# Storage Configuration
storage:
  class:
    fast: "fast-ssd"
    standard: "standard"
    nfs: "nfs-client"
  
  sizes:
    postgres:
      data: "100Gi"
      backup: "500Gi"
    etcd:
      data: "10Gi"
    redis:
      data: "5Gi"
    odoo:
      data: "50Gi"
      addons: "10Gi"
      filestore: "100Gi"

# Resource Limits
resources:
  # Odoo
  odoo:
    test:
      requests:
        cpu: "250m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
    dev:
      requests:
        cpu: "500m"
        memory: "512Mi"
      limits:
        cpu: "2000m"
        memory: "2Gi"
    stage:
      requests:
        cpu: "500m"
        memory: "512Mi"
      limits:
        cpu: "2000m"
        memory: "2Gi"
    prod:
      requests:
        cpu: "1000m"
        memory: "2Gi"
      limits:
        cpu: "4000m"
        memory: "4Gi"
  
  # PostgreSQL
  postgres:
    requests:
      cpu: "1000m"
      memory: "2Gi"
    limits:
      cpu: "4000m"
      memory: "4Gi"
  
  # PgBouncer
  pgbouncer:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "1000m"
      memory: "512Mi"
  
  # Redis
  redis:
    test:
      requests:
        cpu: "50m"
        memory: "128Mi"
      limits:
        cpu: "250m"
        memory: "256Mi"
    prod:
      requests:
        cpu: "250m"
        memory: "512Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"

# Monitoring Configuration
monitoring:
  enabled: true
  prometheus:
    scrape_interval: "30s"
  postgres_exporter:
    port: 9187
  redis_exporter:
    port: 9121

# Backup Configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention_days: 30
  successful_jobs_history: 7
  failed_jobs_history: 3

# Security Configuration
security:
  cert_manager:
    issuer_staging: "letsencrypt-staging"
    issuer_prod: "letsencrypt-prod"
  
  ingress:
    proxy_body_size: "100m"
    proxy_read_timeout: "600"
    proxy_send_timeout: "600"
    rate_limit: 100
  
  basic_auth:
    enabled_stage: true
    enabled_prod: false

# Timeouts and Health Checks
health:
  liveness:
    initial_delay: 90
    period: 30
    timeout: 10
    failure_threshold: 3
  readiness:
    initial_delay: 30
    period: 10
    timeout: 5
    failure_threshold: 3

# CI/CD Configuration
cicd:
  gitlab:
    url: "https://gitlab.yourdomain.com"
  
  docker:
    driver: "overlay2"
  
  test_timeout: "5m"
  deploy_timeout:
    dev: "5m"
    stage: "10m"
    prod: "15m"
  
  auto_stop:
    test_environment: "7 days"

# Feature Flags
features:
  connection_pooler: true
  logical_backup: true
  metrics_export: true
  auto_vacuum: true

# Ingress Configuration
ingress:
  class_name: "nginx"
  
  # Cert Manager
  cert_issuer:
    staging: "letsencrypt-staging"
    prod: "letsencrypt-prod"
  
  # Annotations per environment
  annotations:
    test:
      proxy_body_size: "50m"
      proxy_read_timeout: "300"
      proxy_send_timeout: "300"
      rate_limit: "50"
    dev:
      proxy_body_size: "100m"
      proxy_read_timeout: "600"
      proxy_send_timeout: "600"
      rate_limit: "100"
    stage:
      proxy_body_size: "100m"
      proxy_read_timeout: "600"
      proxy_send_timeout: "600"
      rate_limit: "100"
      basic_auth_enabled: true
    prod:
      proxy_body_size: "100m"
      proxy_read_timeout: "900"
      proxy_send_timeout: "900"
      rate_limit: "200"
      waf_enabled: true
  
  # TLS Configuration
  tls:
    enabled: true
    force_ssl: true
  
  # Wildcard domains for dynamic environments
  wildcard:
    test: true
    dev: true
    stage: false
    prod: false

odoo_versions:
  available:
    - "17.0"
    - "18.0"
    - "19.0"
  
  # Версія для кожного середовища
  default:
    test: "19.0"      # Для тестування нових версій
    dev: "19.0"       # Розробка нових модулів
    stage: "17.0"     # Pre-production на актуальній версії
    prod: "17.0"      # Production
  
  # Можливість перевизначити для конкретного проекту
  projects:
    new-module-1:
      version: "19.0"
    new-module-2:
      version: "19.0"
    legacy-module:
      version: "17.0"

# Теги образів
images:
  odoo:
    registry: "registry.gitlab.yourdomain.com/odoo-team/odoo"
    versions:
      "17.0":
        base_image: "odoo:17.0"
        python_version: "3.10"
      "18.0":
        base_image: "odoo:18.0"
        python_version: "3.11"
      "19.0":
        base_image: "odoo:19.0"
        python_version: "3.11"